// === –£–¢–ò–õ–Ü–¢–ò ===
const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);

const storage = {
  get: (key) => JSON.parse(localStorage.getItem(key) || 'null'),
  set: (key, val) => localStorage.setItem(key, JSON.stringify(val)),
  clear: () => localStorage.clear()
};

function createEl(tag, props = {}, children = []) {
  const el = document.createElement(tag);
  Object.assign(el, props);
  children.forEach(ch => el.appendChild(ch));
  return el;
}

// === 3D-–°–¶–ï–ù–ê ===
let scene, camera, renderer, mesh, tooltip, raycaster, mouse;
let permutations = [];

function initScene() {

    if (typeof THREE === 'undefined') {
      alert('–ü–æ–º–∏–ª–∫–∞: Three.js –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –∞–±–æ –≤–µ—Ä—Å—ñ—é.');
      return;
    }
    if (typeof THREE.OrbitControls === 'undefined') {
      alert('–ü–æ–º–∏–ª–∫–∞: OrbitControls –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ.');
      return;
    }

  const canvas = $('#scene');
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xf9fafb);

  camera = new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.1, 100);
  camera.position.set(0, 0, 12);

  renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
  renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  window.addEventListener('resize', () => {
    camera.aspect = canvas.clientWidth / canvas.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  });

  const ambient = new THREE.AmbientLight(0xffffff, 0.6);
  const dir = new THREE.DirectionalLight(0xffffff, 0.8);
  dir.position.set(5, 5, 5);
  scene.add(ambient, dir);

  // --- –≥–µ–Ω–µ—Ä—É—î–º–æ –≤–µ—Ä—à–∏–Ω–∏ ---
  permutations = generatePermutations([1,2,3,4]);
  const positions = new Float32Array(permutations.flatMap(p => {
    const [a,b,c,d] = p;
    return [a+b-5, a+c-5, b+c-5];
  }));

  const geometry = new THREE.BufferGeometry();
  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

  // —Ä–µ–±—Ä–∞ (–∂–æ—Ä—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ñ –¥–ª—è S‚ÇÑ)
  const edges = generateEdges();
  const lineGeo = new THREE.BufferGeometry();
  const linePos = new Float32Array(edges.flatMap(idx => [
    positions[idx[0]*3], positions[idx[0]*3+1], positions[idx[0]*3+2],
    positions[idx[1]*3], positions[idx[1]*3+1], positions[idx[1]*3+2]
  ]));
  lineGeo.setAttribute('position', new THREE.BufferAttribute(linePos, 3));
  const lineMat = new THREE.LineBasicMaterial({ color: 0x3b82f6 });
  const lines = new THREE.LineSegments(lineGeo, lineMat);
  scene.add(lines);

  const material = new THREE.PointsMaterial({ color: 0x3b82f6, size: 0.25 });
  mesh = new THREE.Points(geometry, material);
  scene.add(mesh);

  // –∫–µ—Ä—É–≤–∞–Ω–Ω—è
  const controls = new THREE.OrbitControls(camera, canvas);
  controls.enableDamping = true;

  // tooltip
  tooltip = createEl('div', { className: 'tooltip', style: 'display:none' });
  document.body.appendChild(tooltip);

  raycaster = new THREE.Raycaster();
  mouse = new THREE.Vector2();

  canvas.addEventListener('pointermove', (e) => {
    mouse.x = (e.clientX / canvas.clientWidth) * 2 - 1;
    mouse.y = -(e.clientY / canvas.clientHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObject(mesh);
    if (intersects.length > 0) {
      const idx = intersects[0].index;
      const perm = permutations[idx];
      tooltip.textContent = `(${perm.join(' ')})`;
      tooltip.style.display = 'block';
      tooltip.style.left = `${e.clientX + 10}px`;
      tooltip.style.top = `${e.clientY + 10}px`;
    } else {
      tooltip.style.display = 'none';
    }
  });

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  return { scene, camera, renderer, mesh, controls };
}

// === –ü–ï–†–ï–°–¢–ê–ù–û–í–ö–ò ===
function generatePermutations(arr) {
  if (arr.length === 1) return [arr];
  const res = [];
  for (let i = 0; i < arr.length; i++) {
    const rest = generatePermutations(arr.slice(0,i).concat(arr.slice(i+1)));
    for (const p of rest) res.push([arr[i], ...p]);
  }
  return res;
}

// —Ä–µ–±—Ä–∞: —Å—É—Å—ñ–¥–Ω—ñ —Ç—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—ó
function generateEdges() {
  const edges = [];
  for (let i = 0; i < permutations.length; i++) {
    const p = permutations[i];
    for (let pos = 0; pos < 3; pos++) {
      const q = [...p];
      [q[pos], q[pos+1]] = [q[pos+1], q[pos]];
      const j = permutations.findIndex(r => r.every((v,k)=>v===q[k]));
      if (j > i) edges.push([i, j]);
    }
  }
  return edges;
}

// === –û–°–ù–û–í–ò ===
const tourStages = [
  { title: "–í–µ—Ä—à–∏–Ω–∏", text: "–ö–æ–∂–Ω–∞ –≤–µ—Ä—à–∏–Ω–∞ ‚Äî —Ü–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∏—Å–µ–ª 1,2,3,4. –£—Å—å–æ–≥–æ 4! = 24 –≤–µ—Ä—à–∏–Ω–∏.", highlight: 'vertices' },
  { title: "–†–µ–±—Ä–∞", text: "–†–µ–±—Ä–æ –∑'—î–¥–Ω—É—î –¥–≤—ñ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏, —â–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è —Ç—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—î—é —Å—É—Å—ñ–¥–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.", highlight: 'edges' },
  { title: "–ì—Ä–∞–Ω—ñ", text: "–Ñ 8 —Ç—Ä–∏–∫—É—Ç–Ω–∏—Ö —ñ 6 —á–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∏—Ö –≥—Ä–∞–Ω–µ–π. –¢—Ä–∏–∫—É—Ç–Ω–∞ ‚Äî —Ü–µ 3-—Ü–∏–∫–ª, —á–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∞ ‚Äî –¥–≤—ñ —Ç—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—ó.", highlight: 'faces' },
  { title: "–°—É—Å—ñ–¥–Ω—ñ—Å—Ç—å", text: "–î–≤—ñ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—É—Å—ñ–¥–Ω—ñ, —è–∫—â–æ —ó—Ö –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–¥–Ω–∞ –∑ –æ–¥–Ω–æ—ó –æ–¥–Ω–∏–º –æ–±–º—ñ–Ω–æ–º —Å—É—Å—ñ–¥–Ω—ñ—Ö —á–∏—Å–µ–ª.", highlight: 'edges' },
  { title: "–¶–µ–Ω—Ç—Ä", text: "–¶–µ–Ω—Ç—Ä –º–Ω–æ–≥–æ–≥—Ä–∞–Ω–Ω–∏–∫–∞ ‚Äî —Ç–æ—á–∫–∞ (2.5, 2.5, 2.5).", highlight: 'center' },
  { title: "–í—ñ–¥—Å—Ç–∞–Ω—å", text: "–í—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –≤–∏–º—ñ—Ä—é—î—Ç—å—Å—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é —Å—É—Å—ñ–¥–Ω—ñ—Ö —Ç—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ–π, –ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –º—ñ–∂ –Ω–∏–º–∏.", highlight: 'metric' },
  { title: "–®–∞—Ä–∏", text: "–ú–æ–∂–Ω–∞ –≤–∏–¥—ñ–ª–∏—Ç–∏ '—à–∞—Ä–∏' –≤—ñ–¥–Ω–æ—Å–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ 1234: —á–∏–º –±—ñ–ª—å—à–µ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Å—Ç–æ—ó—Ç—å –Ω–µ –Ω–∞ —Å–≤–æ—ó—Ö –º—ñ—Å—Ü—è—Ö, —Ç–∏–º –¥–∞–ª—ñ –≤–µ—Ä—à–∏–Ω–∞ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∞.", highlight: 'layers' },
  { title: "–°–∏–º–µ—Ç—Ä—ñ—ó", text: "–ú–Ω–æ–≥–æ–≥—Ä–∞–Ω–Ω–∏–∫ –º–∞—î —Å–∏–º–µ—Ç—Ä—ñ—ó, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è–º –≥—Ä—É–ø–∏ S‚ÇÑ: –≤–æ–Ω–∏ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª—è—é—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –±–µ–∑ –∑–º—ñ–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≥—Ä–∞—Ñ–∞.", highlight: 'symmetry' },
  { title: "–®–ª—è—Ö–∏", text: "–ë—É–¥—å-—è–∫–∏–π —à–ª—è—Ö –º—ñ–∂ –≤–µ—Ä—à–∏–Ω–∞–º–∏ ‚Äî —Ü–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –æ–±–º—ñ–Ω—ñ–≤ —Å—É—Å—ñ–¥–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤. –ö–æ—Ä–æ—Ç–∫—ñ —à–ª—è—Ö–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞–º.", highlight: 'paths' },
  { title: "–û—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—è", text: "–û–±'—î–º–Ω–∞ –º–æ–¥–µ–ª—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ —É 3D-–ø—Ä–æ—Å—Ç–æ—Ä—ñ, –¥–µ –æ—Å—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –ø–æ–∑–∏—Ü—ñ—è–º –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤—Ü—ñ.", highlight: 'orientation' },
];

function startTour({ mesh }) {
  const content = $('#content');
  content.innerHTML = '';
  let idx = storage.get('tourProgress') || 0;

  function showStage(i) {
    if (i >= tourStages.length) {
      content.innerHTML = '<h2>–í—ñ—Ç–∞—î–º–æ!</h2><p>–í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ç—É—Ä.</p>';
      storage.set('tourProgress', 0);
      return;
    }
    const s = tourStages[i];
    content.innerHTML = `
      <h2>${s.title}</h2>
      <p>${s.text}</p>
      <button class="btn" id="next">–î–∞–ª—ñ</button>
    `;
    $('#next').onclick = () => {
      storage.set('tourProgress', i+1);
      showStage(i+1);
    };
  }
  showStage(idx);
}

// === –¢–ï–°–¢–ò ===
const quizDB = [
  { q: "–°–∫—ñ–ª—å–∫–∏ –≤–µ—Ä—à–∏–Ω —É —Ç—Ä–∞–ø–µ—Ü—ñ—î–¥—Ä—ñ S‚ÇÑ?", a: "24", opts: ["12","24","36","48"] },
  { q: "–©–æ –∑'—î–¥–Ω—É—î —Ä–µ–±—Ä–æ?", a: "–¢—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—è —Å—É—Å—ñ–¥–Ω—ñ—Ö", opts: ["3-—Ü–∏–∫–ª","–¢—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—è —Å—É—Å—ñ–¥–Ω—ñ—Ö","4-—Ü–∏–∫–ª","–î–≤—ñ —Ç—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—ó"] },
  { q: "–ü–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏ - —Ü–µ:", a: "–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;", opts: ["–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏."] },
  { q: "–ú—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–æ—é –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è?", a: "–ù–∞–±—ñ—Ä –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –º–∞—î —Å–≤–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å;", opts: ["–ù–∞–±—ñ—Ä –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –º–∞—î —Å–≤–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å;","–ù–∞–±—ñ—Ä –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –≤–∑—è—Ç–∏—Ö –ø–æ –æ–¥–Ω–æ–º—É —Ä–∞–∑—É;","–ù–∞–±—ñ—Ä –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –∫–æ–∂–µ–Ω —è–∫–∏—Ö –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –º–∞—î –æ–¥–Ω–∞–∫–æ–≤—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–ù–∞–±—ñ—Ä –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–ù–∞–±—ñ—Ä –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –≤ —è–∫–æ–º—É –ø–µ–≤–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è –ø–æ —Ä–∞–∑—É, –∞ –ø–µ–≤–Ω–∞ - –ø–æ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑."] },
  { q: "–ü–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å - —Ü–µ:", a: "–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏.", opts: ["–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏.","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;"] },
  { q: "–†–æ–∑–º—ñ—â–µ–Ω–Ω—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å - —Ü–µ:", a: "–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;", opts: ["–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏."] },
  { q: "–ó–∞–≥–∞–ª—å–Ω–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è - —Ü–µ:", a: "–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;", opts: ["–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏ –±—É–¥—å-—è–∫–æ—ó –º–µ–Ω—à–æ—ó, –Ω—ñ–∂ —î –≤ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω—ñ, –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏."] },
  { q: "–†–æ–∑–º—ñ—â–µ–Ω–Ω—è –∑ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏ - —Ü–µ:", a: "–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏, –¥–µ –∫—Ä–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∑ –Ω–∏—Ö –Ω–µ –º–µ–Ω—à–µ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;", opts: ["–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏, –¥–µ –∫—Ä–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∑ –Ω–∏—Ö –Ω–µ –º–µ–Ω—à–µ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏, –¥–µ –∫—Ä–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∑ –Ω–∏—Ö –º–µ–Ω—à–µ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –≤–∏–±—ñ—Ä–∫–∏."] },
  { q: "–°–ø–æ–ª—É—á–µ–Ω–Ω—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å - —Ü–µ:", a: "–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;", opts: ["–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏, –¥–µ –∫—Ä–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∑ –Ω–∏—Ö –Ω–µ –º–µ–Ω—à–µ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏, –¥–µ –∫—Ä–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∑ –Ω–∏—Ö –º–µ–Ω—à–µ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –≤–∏–±—ñ—Ä–∫–∏."] },
  { q: "–°–ø–æ–ª—É—á–µ–Ω–Ω—è –∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏ - —Ü–µ:", a: "–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;", opts: ["–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞–¥–∞–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–∏;","–ù–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏, –¥–µ –∫—Ä–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∑ –Ω–∏—Ö –Ω–µ –º–µ–Ω—à–µ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤;","–£–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–µ—è–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∏, –¥–µ –∫—Ä–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∑ –Ω–∏—Ö –º–µ–Ω—à–µ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –≤–∏–±—ñ—Ä–∫–∏."] },
  { q: "–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –º—ñ–∂ –≤–∏–±—ñ—Ä–∫–æ—é —Ç–∞ —ó—ó –Ω–∞–∑–≤–æ—é, —è–∫—â–æ –º–Ω–æ–∂–∏–Ω–∞ ùê∫, –∑ —è–∫–æ—ó –≤–∏–±–∏—Ä–∞—é—Ç—å —Ç–∞–∫–∞: ùê∫ ={1,2,3,4,5} - —É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ (1, 3, 5, 2, 4); –í—ñ–¥–ø–æ–≤—ñ–¥—ñ:", a: "–ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å;", opts: ["–ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å;","–ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏;","—Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å;","—Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –∑ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏;","–∑–∞–≥–∞–ª—å–Ω–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è;"] },
  { q: "–í –∑–∞–¥–∞—á—ñ —É–ø–∞–∫—É–≤–∞–Ω–Ω—è –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫—ñ–≤ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–º—É–∂–æ–∫ 7, –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫—ñ–≤ 15. –°–∫—ñ–ª—å–∫–∏ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –º–∞—î –º—É–ª—å—Ç–∏–º–Ω–æ–∂–∏–Ω–∞ ùê∫ –≤ –º–æ–¥–µ–ª—ñ —Ü—ñ—î—ó –∑–∞–¥–∞—á—ñ?", a: "63", opts: ["7","63","9","15","22"] },
  { q: "–Ø–∫–æ—é –∑–∞–¥–∞—á–µ—é —î –º–æ–¥–µ–ª—å 4 –∑–∞–¥–∞—á—ñ —É–ø–∞–∫—É–≤–∞–Ω–Ω—è –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫—ñ–≤:", a: "–ª—ñ–Ω—ñ–π–Ω–æ—é —É–º–æ–≤–Ω–æ—é —á–∞—Å—Ç–∫–æ–≤–æ –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–Ω–æ—é –Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è—Ö;", opts: ["–Ω–µ–ª—ñ–Ω—ñ–π–Ω–æ—é –±–µ–∑—É–º–æ–≤–Ω–æ—é –Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è—Ö;","–ª—ñ–Ω—ñ–π–Ω–æ—é —É–º–æ–≤–Ω–æ—é —á–∞—Å—Ç–∫–æ–≤–æ –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–Ω–æ—é –Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è—Ö;","–Ω–µ–ª—ñ–Ω—ñ–π–Ω–æ—é —É–º–æ–≤–Ω–æ—é –Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è—Ö;","–Ω–µ–ª—ñ–Ω—ñ–π–Ω–æ—é —É–º–æ–≤–Ω–æ—é —á–∞—Å—Ç–∫–æ–≤–æ –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–Ω–æ—é –Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è—Ö;","–ª—ñ–Ω—ñ–π–Ω–æ—é —É–º–æ–≤–Ω–æ—é –ø–æ–≤–Ω—ñ—Å—Ç—é –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–Ω–æ—é –Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è—Ö."] },
  { q: "–í –∑–∞–¥–∞—á—ñ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –∑ –Ω–∞–±–æ—Ä–æ–º 7 –∑–∞—è–≤–æ–∫ –∑ —á–∞—Å–∞–º–∏ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è 1, 2, 2, 3, 4, 4, 5 —Ç–∞ ùêø =13, —è–∫–∏–º –±—É–¥–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å ùëÑ –∑–∞—è–≤–æ–∫, —â–æ –º–æ–∂–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –æ–¥–∏–Ω –ø—Ä–∏—Å—Ç—Ä—ñ–π:", a: "5", opts: ["5","7","6","4","3"] },
  { q: "–ë—É–¥—å-—è–∫–∞ –º–∞—Ç—Ä–∏—á–Ω–∞ –≥—Ä–∞", a: "–º–∞—î —Ä–æ–∑–≤'—è–∑–æ–∫ –≤ –º—ñ—à–∞–Ω–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è—Ö;", opts: ["–º–∞—î —Ä–æ–∑–≤'—è–∑–æ–∫ –≤ –º—ñ—à–∞–Ω–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è—Ö;","–º–∞—î —Ä–æ–∑–≤'—è–∑–æ–∫ –≤ —á–∏—Å—Ç–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è—Ö;","–Ω–µ –º–∞—î —Ä–æ–∑–≤'—è–∑–∫—É –Ω—ñ –≤ –º—ñ—à–∞–Ω–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è—Ö, –Ω—ñ –≤ —á–∏—Å—Ç–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è—Ö."] },
  { q: "–ú–∞—Ç—Ä–∏—á–Ω–∞ –≥—Ä–∞ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–∞ –ø–∞—Ä—ñ –¥–≤–æ—ó—Å—Ç–∏—Ö –∑–∞–¥–∞—á:", a: "–ª—ñ–Ω—ñ–π–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è;", opts: ["–ª—ñ–Ω—ñ–π–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è;","–Ω–µ–ª—ñ–Ω—ñ–π–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è;","–æ–¥–Ω–∞ –∑ —è–∫–∏—Ö –ª—ñ–Ω—ñ–π–Ω–∞, –∞ —ñ–Ω—à–∞ - –Ω–µ–ª—ñ–Ω—ñ–π–Ω–∞."] },
  { q: "–ú–∞—Ç—Ä–∏—á–Ω–∞ –≥—Ä–∞ —î –≥—Ä–æ—é", a: "–∑ –Ω—É–ª—å–æ–≤–æ—é —Å—É–º–æ—é;", opts: ["–∑ –Ω—É–ª—å–æ–≤–æ—é —Å—É–º–æ—é;", "–∑ –Ω–µ–Ω—É–ª—å–æ–≤–æ—é —Å—É–º–æ—é;","–≤ —è–∫—ñ–π –¥–µ—è–∫—ñ –ø–∞—Ä—Ç—ñ—ó —î –ø–∞—Ä—Ç—ñ—è–º–∏ –∑ –Ω—É–ª—å–æ–≤–æ—é —Å—É–º–æ—é"] },
  { q: "–ú–µ—Ç–æ–¥ –ë—Ä–∞—É–Ω–∞-–†–æ–±—ñ–Ω—Å–æ–Ω - —Ü–µ –º–µ—Ç–æ–¥ —Ä–æ–∑–≤'—è–∑—É–≤–∞–Ω–Ω—è –º–∞—Ç—Ä–∏—á–Ω–∏—Ö —ñ–≥–æ—Ä", a: "—ñ—Ç–µ—Ä–∞—Ü—ñ–π–Ω–∏–π, –Ω–∞–±–ª–∏–∂–µ–Ω–∏–π;", opts: ["—ñ—Ç–µ—Ä–∞—Ü—ñ–π–Ω–∏–π, –Ω–∞–±–ª–∏–∂–µ–Ω–∏–π;","–Ω–µ —ñ—Ç–µ—Ä–∞—Ü—ñ–π–Ω–∏–π, –Ω–∞–±–ª–∏–∂–µ–Ω–∏–π;","—ñ—Ç–µ—Ä–∞—Ü—ñ–π–Ω–∏–π, —Ç–æ—á–Ω–∏–π;","–Ω–µ —ñ—Ç–µ—Ä–∞—Ü—ñ–π–Ω–∏–π, —Ç–æ—á–Ω–∏–π.","–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ—ñ–∫—Å–∞—Ü—ñ–π"] },
  { q: "–°–∫—ñ–ª—å–∫–∏ –ø–∞—Ä–Ω–∏—Ö –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫ —É S‚ÇÑ?", a: "12", opts: ["6","12","24","8"] },
  { q: "–°—Ç—Ä–∞—Ç–µ–≥—ñ—é –Ω–∞–∑–∏–≤–∞—é—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—é, —è–∫—â–æ?", a: "–ø—Ä–∏ –±–∞–≥–∞—Ç–æ–∫—Ä–∞—Ç–Ω–æ–º—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—ñ –≥—Ä–∏ –≤–æ–Ω–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–ª–∏–≤–∏–π —Å–µ—Ä–µ–¥–Ω—ñ–π –≤–∏–≥—Ä–∞—à;", opts: ["–ø—Ä–∏ –±–∞–≥–∞—Ç–æ–∫—Ä–∞—Ç–Ω–æ–º—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—ñ –≥—Ä–∏ –≤–æ–Ω–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–ª–∏–≤–∏–π —Å–µ—Ä–µ–¥–Ω—ñ–π –≤–∏–≥—Ä–∞—à;","–ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—ñ –≥—Ä–∏ –≤–æ–Ω–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∏–≥—Ä–∞—à;","–≤–æ–Ω–∞ –∑–∞–≤–∂–¥–∏ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∏–≥—Ä–∞—à;","–î—É–±–ª—é–≤–∞–Ω–Ω—è","—ñ —Ç—ñ–ª—å–∫–∏, —è–∫—â–æ –≤–æ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—ñ–¥–ª–æ–≤—ñ–π —Ç–æ—á—Ü—ñ –≥—Ä–∏."] },
  { q: "–ó–∞ –∫—Ä–∏—Ç–µ—Ä—ñ—î–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤–∏–≥—Ä–∞—à—É –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—é –≤–≤–∞–∂–∞—é—Ç—å —Ç—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é, –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ —è–∫–æ—ó –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è –≤–∏–≥—Ä–∞—à—É:", a: "–º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ;", opts: ["–º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ;","–º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ;","–º–∞–∫—Å–∏–º—ñ–Ω–Ω–µ;","–º—ñ–Ω—ñ–º–∞–∫—Å–Ω–µ."] },
  { q: "–ü—Ä–∏–Ω—Ü–∏–ø –º–µ—Ç–æ–¥—É —Ç–∏–ø—É –ë—Ä–∞—É–Ω–∞-–†–æ–±—ñ–Ω—Å–æ–Ω:", a: "–º–∞–π–±—É—Ç–Ω—î —Å—Ö–æ–∂–µ –Ω–∞ –º–∏–Ω—É–ª–µ;", opts: ["–º–∞–π–±—É—Ç–Ω—î —Å—Ö–æ–∂–µ –Ω–∞ –º–∏–Ω—É–ª–µ;","–º–∞–π–±—É—Ç–Ω—î –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–ø–∞–¥–∫–æ–≤–∏–º –∑ –∑–∞–¥–∞–Ω–∏–º–∏ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—è–º–∏ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤;","–º–∞–π–±—É—Ç–Ω—î –Ω–µ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–µ."] },
  { q: "–ü—Ä–∏–ø—É—â–µ–Ω–Ω—è –º–µ—Ç–æ–¥—É —Ç–∏–ø—É –ë—Ä–∞—É–Ω–∞-–†–æ–±—ñ–Ω—Å–æ–Ω: –≥—Ä–∞–≤—Ü—ñ –ø—Ä–∞–≥–Ω—É—Ç—å", a: "–∑–±—ñ–ª—å—à–∏—Ç–∏ —Å–≤—ñ–π –≤–∏–≥—Ä–∞—à;", opts: ["–∑–±—ñ–ª—å—à–∏—Ç–∏ —Å–≤—ñ–π –≤–∏–≥—Ä–∞—à;","–∑–∞—Å—ñ—è—Ç–∏ –ø–æ–ª–µ –ø—Ä–∏–±—É—Ç–∫–æ–≤–æ—é –∫—É–ª—å—Ç—É—Ä–æ—é;","–∑–º–µ–Ω—à–∏—Ç–∏ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –¥–æ–±—Ä–∏–≤–∞;","–∑–º–µ–Ω—à–∏—Ç–∏ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –ø–µ—Ä–µ–≤–µ–∑–µ–Ω–Ω—è."] },
  { q: "–Ø–∫–∏–π —Ü–∏–∫–ª –º–∞—î –≤–∏–≥–ª—è–¥ (1 2 3 4)?", a: "4-—Ü–∏–∫–ª", opts: ["3-—Ü–∏–∫–ª","4-—Ü–∏–∫–ª","2-—Ü–∏–∫–ª","–¢—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—è"] },
  { q: "–Ø–∫–∞ –∑–∞–¥–∞—á–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –º–æ–∂–µ —Ä–æ–∑–≤'—è–∑—É–≤–∞—Ç–∏—Å—è –º–µ—Ç–æ–¥–æ–º –≥—ñ–ª–æ–∫ —Ç–∞ –º–µ–∂:", a: "–±—É–¥—å-—è–∫–∞ –∑–∞–¥–∞—á–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó", opts: ["–±—É–¥—å-—è–∫–∞ –∑–∞–¥–∞—á–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó", "—Ç—ñ–ª—å–∫–∏ –∑ –ª—ñ–Ω—ñ–π–Ω–æ—é —Ü—ñ–ª—å–æ–≤–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é —Ç–∞ –ª—ñ–Ω—ñ–π–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏;","—Ç—ñ–ª—å–∫–∏ –∑ –ª—ñ–Ω—ñ–π–Ω–æ—é —Ü—ñ–ª—å–æ–≤–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é —Ç–∞ –Ω–µ–ª—ñ–Ω—ñ–π–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏;","—Ç—ñ–ª—å–∫–∏ –∑ –Ω–µ–ª—ñ–Ω—ñ–π–Ω–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é;","—Ç—ñ–ª—å–∫–∏ –∑ –Ω–µ–ª—ñ–Ω—ñ–π–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏;"] },
];


// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è –º–∞—Å–∏–≤—É
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function startQuiz() {
  const content = $('#content');
  content.innerHTML = '';

  let score = 0;
  let qIdx = 0;

  const questions = shuffle([...quizDB]);

  let wrongAnswers = [];

  function showQ() {

    // === –í–ò–í–Ü–î –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í ===
    if (qIdx >= questions.length) {

      let wrongHTML = wrongAnswers.length
        ? `<h3>–í–∞—à—ñ –ø–æ–º–∏–ª–∫–∏:</h3><ul>` +
          wrongAnswers.map(w =>
            `<li><strong>${w.q}</strong><br>
             –í–∞—à –≤–∞—Ä—ñ–∞–Ω—Ç: <span style="color:red">${w.user}</span><br>
             –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: <span style="color:green">${w.correct}</span>
            </li>`
          ).join('') +
          `</ul>`
        : `<p>–£—Å—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ! üéâ</p>`;

      content.innerHTML = `
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${score}/${questions.length}</h2>
        ${wrongHTML}
        <button class="btn" id="restart">–©–µ —Ä–∞–∑</button>
      `;
      $('#restart').onclick = startQuiz;
      return;
    }

    const q = questions[qIdx];

    const opts = q.opts.map(o => `
      <label><input type="radio" name="q" value="${o}"> ${o}</label><br>
    `).join('');

    content.innerHTML = `
      <p><em>–ü–∏—Ç–∞–Ω–Ω—è ${qIdx + 1} / ${questions.length}</em></p>
      <p><strong>${q.q}</strong></p>
      ${opts}
      <button class="btn" id="check">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
    `;

    $('#check').onclick = () => {
      const sel = $('input[name="q"]:checked');
      if (!sel) return alert('–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç');

      if (sel.value === q.a) {
        score++;
      } else {
        wrongAnswers.push({
          q: q.q,
          user: sel.value,
          correct: q.a
        });
      }

      qIdx++;
      showQ();
    };
  }

  showQ();
}


// === –ß–ê–¢-–ë–û–¢ ===

const baseKnowledge = [
  {
    keys: ["–ø—Ä–∏–≤—ñ—Ç", "–≤—ñ—Ç–∞—é", "—Ö—Ç–æ —Ç–∏", "—â–æ —Ç–∏ –≤–º—ñ—î—à"],
    answerLong: "–ü—Ä–∏–≤—ñ—Ç! –Ø –≥—ñ–¥ –ø–æ —Å–≤—ñ—Ç—É –≥–µ–æ–º–µ—Ç—Ä—ñ—ó. –ó–æ–∫—Ä–µ–º–∞, —è –∑–Ω–∞—é –≤—Å–µ –ø—Ä–æ –ú–Ω–æ–≥–æ–≥—Ä–∞–Ω–Ω–∏–∫ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫ (–ø–µ—Ä–º—É—Ç–∞–µ–¥—Ä) 4 ‚Äî —Ü–µ —Ñ—ñ–≥—É—Ä–∞, —â–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –≤—Å—ñ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–∏—Å–µ–ª {1, 2, 3, 4} —É 3D –ø—Ä–æ—Å—Ç–æ—Ä—ñ. –ó–∞–ø–∏—Ç—É–π –ø—Ä–æ –≤–µ—Ä—à–∏–Ω–∏, –≥—Ä–∞–Ω—ñ –∞–±–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏!"
  },
  {
    keys: ["–∫—ñ–ª—å–∫—ñ—Å—Ç—å", "—Å–∫—ñ–ª—å–∫–∏", "–≤–µ—Ä—à–∏–Ω", "–≤–µ—Ä—à–∏–Ω–∞"],
    answerLong: "–§—ñ–≥—É—Ä–∞ –º–∞—î 24 –≤–µ—Ä—à–∏–Ω–∏. –¶–µ —á–∏—Å–ª–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î 4! (4 —Ñ–∞–∫—Ç–æ—Ä—ñ–∞–ª), —Ç–æ–±—Ç–æ –≤—Å—ñ–º –º–æ–∂–ª–∏–≤–∏–º —Å–ø–æ—Å–æ–±–∞–º –≤–ø–æ—Ä—è–¥–∫—É–≤–∞—Ç–∏ —á–∏—Å–ª–∞ 1, 2, 3 —Ç–∞ 4. –ö–æ–∂–Ω–∞ —Ç–æ—á–∫–∞ ‚Äî —Ü–µ –æ–¥–Ω–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞."
  },
  {
    keys: ["—â–æ", "—Ç–∞–∫–µ", "—Ä–µ–±—Ä–æ", "—Ä–µ–±—Ä–∞", "–∑–≤'—è–∑–æ–∫"],
    answerLong: "–†–µ–±—Ä–æ –∑'—î–¥–Ω—É—î –¥–≤—ñ –≤–µ—Ä—à–∏–Ω–∏, —è–∫—ñ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è –ª–∏—à–µ –æ–¥–Ω—ñ—î—é '—Å—É—Å—ñ–¥–Ω—å–æ—é —Ç—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü—ñ—î—é' (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 1234 —Ç–∞ 2134). –£—Å—å–æ–≥–æ —É —Ñ—ñ–≥—É—Ä—ñ 36 —Ç–∞–∫–∏—Ö —Ä–µ–±–µ—Ä."
  },
  {
    keys: ["—Å–∫—ñ–ª—å–∫–∏", "–≥—Ä–∞–Ω–µ–π", "–≥—Ä–∞–Ω—ñ", "—è–∫–∞ —Ñ–æ—Ä–º–∞"],
    answerLong: "–¶–µ–π –±–∞–≥–∞—Ç–æ–≥—Ä–∞–Ω–Ω–∏–∫ –º–∞—î 14 –≥—Ä–∞–Ω–µ–π: 6 –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ (–∞–±–æ —á–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∏–∫—ñ–≤) —Ç–∞ 8 –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —à–µ—Å—Ç–∏–∫—É—Ç–Ω–∏–∫—ñ–≤. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É: —É –≤–∞—à—ñ–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó –∑–≥–∞–¥—É–≤–∞–ª–∏—Å—è —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∏, –∞–ª–µ –∫–ª–∞—Å–∏—á–Ω–∏–π –ø–µ—Ä–º—É—Ç–∞–µ–¥—Ä —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è —Å–∞–º–µ –∑ 6 –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ —Ç–∞ 8 —à–µ—Å—Ç–∏–∫—É—Ç–Ω–∏–∫—ñ–≤."
  },
  {
    keys: ["—Ü–µ–Ω—Ç—Ä", "–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ü–µ–Ω—Ç—Ä—É", "—Å–µ—Ä–µ–¥–∏–Ω–∞"],
    answerLong: "–¶–µ–Ω—Ç—Ä —Ñ—ñ–≥—É—Ä–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ç–æ—á—Ü—ñ (2.5, 2.5, 2.5, 2.5) —É 4D –ø—Ä–æ—Å—Ç–æ—Ä—ñ, –∞–±–æ (2.5, 2.5, 2.5) –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ü—ñ—ó. –¶–µ —Å–µ—Ä–µ–¥–Ω—î –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–µ –≤—Å—ñ—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫."
  },
  {
    keys: ["–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏", "—Ç–æ—á–∫–∏", "—á–∏—Å–ª–∞"],
    answerLong: "–ö–æ–∂–Ω–∞ –≤–µ—Ä—à–∏–Ω–∞ –º–∞—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏, —â–æ —î –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–æ—é —á–∏—Å–µ–ª (1, 2, 3, 4). –ù–∞–ø—Ä–∏–∫–ª–∞–¥: (1, 2, 3, 4), (4, 3, 2, 1) —ñ —Ç–∞–∫ –¥–∞–ª—ñ. –°—É–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–æ–∂–Ω–æ—ó –≤–µ—Ä—à–∏–Ω–∏ –∑–∞–≤–∂–¥–∏ –¥–æ—Ä—ñ–≤–Ω—é—î 10."
  },
  {
    keys: ["–Ω–∞–∑–≤–∞", "—Ñ—ñ–≥—É—Ä–∞", "—â–æ —Ü–µ"],
    answerLong: "–¶—è –≥–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∞ —Ñ—ñ–≥—É—Ä–∞ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è –ü–µ—Ä–º—É—Ç–∞–µ–¥—Ä (Permutahedron). –í–æ–Ω–∞ —î —á–∞—Å—Ç–∏–Ω–æ—é —Å—ñ–º–µ–π—Å—Ç–≤–∞ –Ω–∞–ø—ñ–≤–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –±–∞–≥–∞—Ç–æ–≥—Ä–∞–Ω–Ω–∏–∫—ñ–≤ —ñ –≤—ñ–∑—É–∞–ª—ñ–∑—É—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫."
  }
];



function findSmartAnswer(text) {
  text = text.toLowerCase();
  let best = { score: 0, item: null };

  for (const item of baseKnowledge) {
    let score = 0;
    for (const key of item.keys) {
      if (text.includes(key)) score += 5; // –ü—Ä—è–º–µ –≤—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–ª—é—á–∞
    }

    if (score > best.score) {
      best.score = score;
      best.item = item;
    }
  }

  return best.score >= 5 ? best.item : null;
}

async function typeWriterEffect(text, element) {
  element.innerHTML = ""; 
  let i = 0;
  return new Promise(resolve => {
    const interval = setInterval(() => {
      element.innerHTML += text[i];
      i++;
      if (i >= text.length) {
        clearInterval(interval);
        resolve();
      }
    }, 15); 
  });
}

function showTypingIndicator(box) {
  const div = document.createElement("div");
  div.id = "typing";
  div.style.fontStyle = "italic";
  div.style.color = "#888";
  div.innerHTML = `–ë–æ—Ç –¥—Ä—É–∫—É—î‚Ä¶`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

function hideTypingIndicator() {
  const el = document.getElementById("typing");
  if (el) el.remove();
}

function initChat() {
  const content = document.getElementById('content');
  content.innerHTML = `
    <div id="chatbox" style="height:350px; overflow-y:auto; border:1px solid #ddd; padding:1rem; border-radius:8px; background:#f9f9f9; margin-bottom:1rem;"></div>
    <div style="display:flex; gap:5px;">
        <input id="msg" placeholder="–ó–∞–ø–∏—Ç–∞–π—Ç–µ –ø—Ä–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–µ—Ä—à–∏–Ω, –≥—Ä–∞–Ω–µ–π –∞–±–æ –Ω–∞–∑–≤—É..." style="flex-grow:1; padding:0.7rem; border-radius:5px; border:1px solid #ccc;">
        <button class="btn" id="send" style="padding:0.7rem 1.5rem; cursor:pointer;">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    </div>
  `;

  const box = document.getElementById('chatbox');
  const input = document.getElementById('msg');

  const processMessage = async () => {
    const txt = input.value.trim();
    if (!txt) return;

    addMsg(txt, 'user');
    input.value = '';

    const result = findSmartAnswer(txt);
    showTypingIndicator(box);

    setTimeout(async () => {
      hideTypingIndicator();
      if (result === null) {
        addMsg("–¶—ñ–∫–∞–≤–µ –ø–∏—Ç–∞–Ω–Ω—è! –ù–∞ –∂–∞–ª—å, —è —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—é—Å—è –ª–∏—à–µ –Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó –ø–µ—Ä–º—É—Ç–∞–µ–¥—Ä–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø–∏—Ç–∞—Ç–∏ –ø—Ä–æ –≤–µ—Ä—à–∏–Ω–∏ –∞–±–æ –≥—Ä–∞–Ω—ñ.", "bot");
      } else {
        const msgDiv = document.createElement("div");
        msgDiv.className = "bot-msg";
        msgDiv.style.background = "#eef4ff";
        msgDiv.style.padding = "8px";
        msgDiv.style.borderRadius = "5px";
        msgDiv.style.margin = "5px 0";
        box.appendChild(msgDiv);
        await typeWriterEffect(result.answerLong, msgDiv);
      }
      box.scrollTop = box.scrollHeight;
    }, 600);
  };

  document.getElementById('send').onclick = processMessage;
  input.onkeypress = (e) => { if(e.key === 'Enter') processMessage(); };

  function addMsg(text, sender) {
    const div = document.createElement('div');
    div.style.margin = "0.5rem 0";
    div.style.textAlign = sender === 'user' ? 'right' : 'left';
    
    const span = document.createElement('span');
    span.style.display = "inline-block";
    span.style.padding = "8px 12px";
    span.style.borderRadius = "10px";
    span.style.background = sender === 'user' ? '#007bff' : '#eee';
    span.style.color = sender === 'user' ? '#fff' : '#333';
    span.innerHTML = text;
    
    div.appendChild(span);
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  }
}

// === –ì–û–õ–û–í–ù–ï –ú–ï–ù–Æ ===
document.addEventListener('DOMContentLoaded', () => {
  const three = initScene();

  $$('[data-mode]').forEach(btn => {
    btn.addEventListener('click', () => {
      const mode = btn.dataset.mode;
      $('#content').innerHTML = '';
      if (mode === 'tour') startTour(three);
      if (mode === 'quiz') startQuiz();
      if (mode === 'chat') initChat();
    });
  });

  $('#clear').addEventListener('click', () => {
    if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å?')) {
      storage.clear();
      location.reload();
    }
  });
});


